1-й слайд

Всем привет! Меня зовут Андрей и я Computer Vision - голик и состою в группе punch-to-face. 

Сегодня мы поговорим о стремительно набирающей обороты сфере 3Д реконструкции, а именно о применениях ее методов к боям ММА - смешных боевых искувств.

2-й слайд

У тех кто не был на просторах слака ods.ai, не видел наш фирменный эмоджи или не клюнул на навязчивую рекламу Андрея  Спиридонова в каналах #careers, #random_talks, #ods_pet_projects, наверно появился вопрос - а что такое хаштаг punch-to-face. 

Ну во первых это канал в слаке ods.ai посвященный 3Д реконструкции на который подписано 269 человека, и в котором можно найти много интересных обсуждений завязанных не только на ММА.

Во вторых это канал в телеграмме, где тусуется 13 человек и общаются уже исключительно о ММА и немного о других вещах о которых стыдно говорить на публике. 

Ну и самое главное, punch-to-face это амбициозный проект, который хочет привнести в бои без правил немного того, что мы все здесь так любим - машинное обучение и Data Science. 

Мы работаем над созданием интернет портала, в котором можно было бы посмотреть бои всех организаций с такими крутыми фишками как возможность смотреть бои с разных ракурсов (даже с перспективы одного из бойцов), умной ненавязчивой рекламой и интреактивной статистикой

3-й слайд

Наш проект еще достаточно молод  и мы сейчас на стадии формирования и предварительного тестирования гипотез. 

Из наших достижений на данный момент хочу выделить то, что мы собрали датасет из 300 примеров с очень хорошей разметкой для тестирования гипотез семантической сегментации (у нас 4 класс пол, люди, информационный табло и фон) и паноптической сегментации людей.

4-й слайд

Также мы отсняли постановочный бой с 23 камер для тестирования гипотез multi-view реконструкции и накачали видео в высоком разрешении с ютуба для работы с монокулярными видео.

Мы общаемся и договариваемся о сотрудничестве с ММА организациями и даже наш десант присутствовал на турнире ММА неделю назад в Краснодаре, где мы добыли много интересного материала в высоком качества.

Все данные которые я упомянул находятся в открытом доступе, но пока без лицензии. Мы работаем над тем чтобы опубликовать их в формате kaggle dataseta, а пока вы можете найти ссылки в наше канале ods.ai

5-й слайд

Довольно наглой рекламы, перейдем к делу - что нужно сделать чтобы восстановить сцену боя ММА? Во первых нужно восстановить 3-мерную модель человека

3Д модель или по-другому мэш - это набор точек в трехмерном пространстве объединеные отрезками - по-другому ребрами. Чем больше многоугольников в модели - тем красивее и плавнее она получается.

Во вторых, после того как мы восстановили модель - нам нужно ее разукрасить. Для этого нам нужно две вещи - это текстура и UV-карта. 

Текстура - это обычный двух мерный рисунок, который похож на вот эту картинку. 

UV-карта - это карта соответствий точек на текстуре и точек на модели. С помощью ее мы наклеиваем текстуру на нашу модель.

Напоследок, готовую модель нужно поместить в сцену. По 2-мерной картинке узнать где находится 3-мерный координаты модели это не всегда такая простая задача как кажется.

Повторите эти шаги 3 раза на каждый кадр ( по разу на рефери и двух бойцов) - и вуаля  - мы получили 3Д реконструкцию боя.

6-й слайд

На этом слайде я собрал список лучших методов в открытом доступе для решения задач связанных с 3Д реконструкцией людей, и оставил небольшой комментарий. 

Большинство из них работает на сверхточных нейронных сетях, о многих я сегодня расскажу, о других вы можете узнать пройдя по ссылкам на последнем слайде, как только презентация станет доступна для скачивания. 

Для многих систем из этого списка нужно потратить много времени чтобы их запустить, потому что у них много зависимостей. 

К счастью, в большинстве случаев кто-то из подписчиков нашего канала уже пытался запустить нужную вам систему, поэтому не стесняйтесь спрашивать о помощи в нашем канале

7-й слайд

Я вообще хотел сделать этот доклад что-то вроде полуворкшопа, где я детально расскажу через что нужно пройти чтобы грубо восстановить движения одного бойца по видео с одной камеры, поэтому следующие 20 минут пройдут таким обрзом:

Сначала я расскажу о о особенностях реконструкции боев ММА, чем она отличается от реконструкции например футбола или создания виртуальной примерочной.

Потом я детально пройдусь по каждой из трех подзадач реконструкции, расскажу какие существуют state-of-the-art подходы, чего им не хватает и что делается чтобы восполнить пробелы. 

В секции реконструкции меша я еще выделю немного времени для обсуждения трекинга ключевых точек скелета на двух-мерной картинке, потому что я считаю эту задачу исключительно важной для общего успеха пайплайна.

Если время будет позволять, я расскажу о возможных улучшениях получившейся грубой реконструкции, которые требует решения задачи паноптической сегментации бойцов.

Вторым бонусом я расскажу о другом подходе к реконструкции, где не нужно восстанавливать модель на каждый кадр, а можно подготовить модель перед боем и потом просто двигать ее с помощью 3Д скелета.

Но скорее всего я не успею перейти к бонусам и мне придется оформить материал как два поста в наш канал ОДС, что будет дополнительны стимулом вам подписать на нас в слаке.
8-й слайд

В чем же особенности реконструкции ММА?

Во первых мы реконструируем людей. В этом есть свои плюсы и минусы. Минус в том что тело человека это очень сложный объект, по сравнению например с кубом. 

Плюс в том, что люди уже давно интересуются реконструкцией себя, поэтому мы можем воспользоваться множеством готовых моделей и подходов.

Вторая особенность - это фиксированное количество людей в сцене. Реконструкция двух-трех людей это конечно сложнее чем реконструкция одного человека, но все же не толпа. 

Мы можем оптимизировать некоторые алгоритмы используя это информацию, что у нас два человека в кадре, если будет время я покажу это на примере паноптической сегментации.

Третья особенность это динамичность сцены. Текстуры бойцов и пола постояло меняются из-за освещения и теней и иногда из-за крови. 

Ну и самая ужасная особенность ММА это occlusion или перекрытие, что видно на примере трех картинок на этом слайде.

Хочу обратить ваше внимание на кадр в первом нижнем углу. Чтобы реконструировать этот кадр, нейронной сетке нужно определить какая нога относится к какому бойцу. 

Научить сетку делать это - очень сложная задача, особенно если тренировать на HD картинках на кропах, ведь чтобы понять где чья нога, даже человека нужно иметь понимание всей сцены. 

Я в принципе и сам лос их пор не до конца уверен где какая нога..

9-й слайд

Теперь имея ввиду эти факторы, мы можем обсудить техники воссоздания модели. 

Многие системы реконструкции меша используют трекинг ключевых точек позы как часть пайплайна, как фичи, для псевдолейблинга или для вырезания отдельных людей из кадра. 

Так же использование ошибки 2Д репроэкции скелета как часть функции потерь/лосса - это стандарт современной реконструкции.

Дополнительно, но не обязательно, в реконструкции использовать информацию о силуэте которую можно получить  с помощью паноптической сегментации. 

Силуэт можно использовать как часть лосса, но еще можно закрасить фон, облегчая задачу нейронной сети, особенно если на фоне  есть другой человек (*добавить картинку*)

Получив информацию о скелете и/или силуэте можно переходить к основной задачи - регессии вершин модели.

Эффективно регрессия подбирает координаты вершин так, чтобы  получившиеся модель максимально соответствовала с той визуальной информации что мы получаем с картиники.

В результате мы получим что-то вроде на вот этой картинке, возможно еще более детализированное

10-й слайд

Трекинг 2Д позы это в принципе самая простая и наиболее решенная задача из всех что я буду обсуждать. 
В этом вы можете убедиться сами из гифки внизу. Да может результаты и выглядят немного шумными, но их вполне возможно сгладить дополнительными евристиками.

Есть два вида детекторов 2Д позы - bottom-up и top-down. 

Top-down сначала детектит прямоугольник с человеком, потом находит ключевые точки.
 
Пример такого детектора MaskRCNN в keypoint режиме, когда после детекции человека, делается операция RoI Allign (вырезается bbox и меняется размер картикнки) и потом fully-convolutional нейронная сеть находит координаты ключевых точек.

Отличие Bottom-up методов в том, что они сначала находят точки, а потом группируют их в людей.

Трекинг (когда мы работает не с одним кадром, а с видео) - легче делать с помощью top-down, потому что потом нужно только находить соответствие по bbox-ам , а не по каждой точке, очень сильно уменьшая complexity задачи.

В целом и в общем Top-Down методы с большим отрывом побеждают как на датасетах с отдельными кадрами (COCO) так и с трекингом (PoseTrack), c двумя большими но:

они плохо улавливают сложные позы например прыжок или удар ногой в ММА
они очень плохо справляются с перекрытием, чаще всего просто игнорируя перекрытого человека

К сожалению этого добра в ММА хватает, и из-за этого трекинг с помощью top-down методов довольно быстро ломается, как видно на вот этой гифке. 

Алгоритм просто теряется и не может сново вернутся туда где находится боец.

Поэтому в нашей проблеме стоит присмотреться и к top-down методам и к bottom-up методам. 

Я думаю что это было бы хорошей PhD работой - найти золотую середину между этими двумя подходами, научиться “переключатсья” между ними, например с помощью умного трекинга.

11-й  слайд

Перед тем как я перейду непосредственно к обсуждению реконструкции меша, мне нужно представить вам самую популярную статистическую модель человеческого тела - SMPL. 

Эта модель берет на вход 85 параметров - включая 72 параметра позы, 10 формы и 3 параметра ракурса и выплевывает на выход довольно детализированный пеш с 6890 вершинами и 13776 ребрами.

Сама по себе модель выглядит в целом неочень, она например не может передать волосы или одежду. 

Но многие методы используют вариант модели SMPL-D или SMPL-X и дооптимизруют положение вершин чтобы передать детали, которая SMPL сама по себе передать не может.
